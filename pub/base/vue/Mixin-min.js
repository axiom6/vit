var Mixin,hasProp={}.hasOwnProperty;import Util from"../util/Util.js";import Vis from"../../draw/base/Vis.js";Mixin=class n{constructor(e,i){n.Main=e,n.views=i}mixin(){return{created:function(){},methods:{mix:function(){return{isDef:function(n){return null!=n&&"None"!==n},isStr:function(n){return this.isDef(n)&&"string"==typeof n&&n.length>0},isArray:function(n){return this.isDef(n)&&"string"!=typeof n&&null!=n.length&&n.length>0},inArray:function(n,e){return this.isArray(e)&&e.indexOf(n)>-1},isChild:function(n){var e,i;return e=n.charAt(0),i=n.charAt(n.length-1),e===e.toUpperCase()&&"$"!==e&&"_"!==i},keys:function(n){return Object.keys(n)},hasElem:function(n){return null!=n&&null!=n.clientHeight&&n.clientHeight>0},getElem:function(n,e){var i;return i=n[e],console.log("Mixin.getElem() $refs[name]   ",n,i,e),this.hasElem(i)||null==i[0]?(console.error("Mixin.hasElem() unable to find elem in $refs[name][0]",e),i=null):(i=n[e][0],console.log("Mixin.getElem() $refs[name][0]",n,i,e),this.hasElem(i)||(console.error("Mixin.hasElem() unable to find elem in $refs[name]",e),console.dir(n),i=null)),i},styleObj:function(n,e){var i,t;return i=[30,90,90],this.isDef(n)&&(this.isDef(n.hsv)?i=n.hsv:this.isDef(n.dir)&&(i=function(){switch(n.dir){case"west":return[195,90,70];case"north":return[90,90,90];case"east":return[30,60,90];case"south":return[60,90,90];default:return[30,90,90]}}())),t={backgroundColor:Vis.toRgbaHsv(i)},e&&(t.fontSize=e+"rem"),t},toRgbaHsv:function(n){return Vis.toRgbaHsv(n)},app:function(){return n.Main.app},isMuse:function(){return"Muse"===this.app()},subscribe:function(e,i,t){n.Main.stream.subscribe(e,i,t)},publish:function(e,i){n.Main.stream.publish(e,i)},stream:function(){return n.Main.stream},batch:function(){return n.Main.Batch},fontSize:function(e){return(null!=e?e:1)*(null!=n.Main.fontSize?n.Main.fontSize:2)+"vmin"},fontSizeCss:function(n){return{fontSize:this.fontSize(n)}},nav:function(){return null==n.Main.nav&&console.error("Mixin.nav() null"),n.Main.nav},touch:function(){return null==n.Main.touch&&console.error("Mixin.touch() null"),n.Main.touch},isTouch:function(){return null!=n.Main.touch},isNav:function(){return null!=n.Main.nav},navRoute:function(){return this.isNav()?this.nav().route:this.isDir()?this.dir().route:"None"},isRoute:function(n){return n===this.navRoute()},isBatch:function(e){return null!=n.Main.Batch[e]},prin:function(){return n.Main.Batch.Prin.data.pracs},comps:function(e){return n.Main.Batch[e].data.comps},kompsTocs:function(){return n.Main.komps},views:function(){return n.views},subset:function(n,e){var i,t,r,o;for(t in i={},o=this.pracs(n))hasProp.call(o,t)&&e(r=o[t])&&(i[t]=r);return i},conns:function(n){var e;return e="Prin"!==n?function(n){return"Dim"!==n.row}:function(n){return"Dim"===n.row},this.subset(n,e)},pracs:function(e){return n.Main.Batch[e].data.pracs},disps:function(e,i){return n.Main.Batch[e].data[i].disps},areas:function(e,i,t){return n.Main.Batch[e].data[i][t].areas},items:function(e,i,t,r){return n.Main.Batch[e].data[i][t][r].items},bases:function(e,i,t,r,o){return n.Main.Batch[e].data[i][t][r][o].bases},compObject:function(e){return null!=n.Main.Batch[e]?n.Main.Batch[e].data.pracs:(console.error("Mixin.compObject() bad compKey",e),{})},inovObject:function(n,e){var i,t,r,o,c,s;if(s={},this.isBatch(n)){if(i=this.pracs(n),this.isDef(e)&&e!==n&&this.isBatch(e))for(o in r=this.pracs(e),i)"Innovate"===(c=i[o]).column&&"Dim"!==c.row?s[(t=this.getPrac(r,c.row,c.column,e)).name]=t:s[o]=c;else s=i;return s}return console.error("Mixin.inovObject() bad compKey or inovKey",{compKey:n,inovKey:e}),s},hasInov:function(n){return"Info"===n||"Know"===n||"Wise"===n},getPrac:function(n,e,i,t){var r,o;for(r in n)if((o=n[r]).row===e&&o.column===i)return o;return console.error("Mixin.getPrac() missing prac for",{inovKey:t,row:e,column:i}),{}},pracObject:function(n,e,i){var t,r;return t={},null!=(r=this.inovObject(n,e))[i]?t=r[i]:console.error("Mixin.pracObject() unknown pracKey",{compKey:n,inovKey:e,pracKey:i,pracs:r}),t},sectObject:function(n,e){var i,t,r;return r=this.compObject("Talk")[n],console.log("Mixin.sectObj()",{talkObj:r,talkKey:n,sectKey:e}),t=this.compObject(r.comp),r.keys=null!=r.keys?r.keys:Util.childKeys(t),null==(i=t[e="None"!==e&&this.inArray(e,r.keys)?e:this.keys(t)[0]])&&(console.error("Nav.sectObject null",{pracKey:n,dispKey:e}),i={}),i.src=r.src,i.name=e,i.peys=r.keys,i.keys=null!=i.keys?i.keys:Util.childKeys(i),i.imgsIdx!==this.nav().imgsIdx&&(i=Object.assign({},i)),i.imgsIdx=this.nav().imgsIdx,i},presObject:function(n,e){var i;return i=null,"None"!==(e="None"===e&&null!=n.keys[0]?n.keys[0]:e)&&null!=n[e]&&((i=n[e]).src=n.src,i.name=e,i.peys=n.keys,i.keys=null!=i.keys?i.keys:Util.childKeys(i),console.log("Mixin.pageObj()",{dispKey:n.name,presKey:e,pageObj:i})),i},dataObject:function(n,e){var i;return i=null,"Prac"===n.type?i=this.pracObject(n.src,n.name):"Disp"===n.type&&"None"!==e&&(i=this.dispObject(n.src,"None",n.name,e)),i},dispObject:function(n,e,i,t){var r,o,c;return r={},null!=(c=this.inovObject(n,e))[i]?null!=(o=c[i])[t]?r=o[t]:console.error("Mixin.dispObject() unknown dispKey",{compKey:n,inovKey:e,pracKey:i,dispKey:t}):console.error("Mixin.dispObject() unknown pracKey",{compKey:n,inovKey:e,pracKey:i,dispKey:t}),r},isPageKeyComp:function(n){return"Info"===n||"Data"===n},choice:function(){return n.Main.Batch.Choice.data},choices:function(n){var e;return null!=(e=this.choice()[n])?e.choices:(console.error("Mixin.choices() bad choice name",{name:n}),[])},choose:function(n,e){var i;null!=(i=this.choice()[n])?(i.choices[i.idx]=e,i.idx=++i.idx%i.choices.length):console.error("Mixin.choose() bad choice",{name:n,choice:e})},choosen:function(n,e){return null!=this.choice()[n]&&this.inArray(e,this.choices(n))},choiceIndex:function(n,e){var i,t;return i=0,null!=(t=this.choice()[n])?i=-1===(i=t.choices.indexOf(e))?0:i:console.error("Mixin.choiceIndex() bad choice name",{name:n,idx:i}),i},appendImgsHW:function(n,e){var i,t;return i={},(t=new Image).onload=function(){return i.iw=this.width,i.ih=this.height,i.ew=e.clientWidth,i.eh=e.clientHeight,i.r=Math.min(i.ew/i.iw,i.eh/i.ih),t.width=i.iw*i.r,t.height=i.ih*i.r,null!=e.children[0]&&e.children[0].remove(),e.append(t)},t.src=n}}},nav:function(){return this.mix().nav()}}}}};export default Mixin;