var Index,hasProp={}.hasOwnProperty;Index=class{constructor(e){this.insert=this.insert.bind(this),this.store=e,this.dbName=this.store.dbName,this.tables=this.store.tables,this.keyPath="id",window.indexedDB.deleteDatabase(this.dbName)}async initDB(){this.db=await async function(e){return await e.openDB(e.dbName,e.version())}(this)}openDB(e,t){return new Promise((r,o)=>{var s;return(s=window.indexedDB.open(e,t)).onupgradeneeded=e=>{var t,r;t=e.target.result,r=e.target.transaction,this.openStores(t,!0),r.complete},s.onsuccess=e=>{var t;t=e.target.result,this.openStores(t,!1),r(t)},s.onblocked=()=>{this.store.onerror(e,"open",{cause:"Index.openDB() onblocked",error:s.error}),o()},s.onerror=()=>{this.store.onerror(e,"open",{cause:"Index.openDB() onerror",error:s.error}),o()}})}openStores(e,t){var r,o;for(o in r=this.tables)hasProp.call(r,o)&&(r[o],this.openStore(e,o,t))}contains(e,t){return e.objectStoreNames.contains(t)}openStore(e,t,r){r&&!this.contains(e,t)&&e.createObjectStore(t,{keyPath:this.keyPath})}txo(e,t="readwrite"){return this.db.transaction(e,t).objectStore(e)}version(){var e,t;return localStorage.setItem("IndexDbVersion","0"),t=(e=null!=(t=localStorage.getItem("IndexDbVersion"))?parseInt(t)+1:1).toString(),localStorage.setItem("IndexDbVersion",t),console.log("Index() version",t,e),e}batch(e,t,r,o=null){var s,n;s=s=>{if(t.result=s,this.store.batchComplete(r))return null!=o?o(r):this.store.results(e,"batch",r)},n=function(){return!0},this.select(t.table,n,s)}get(e,t,r,o="get"){var s,n;n=this.txo(e,"readonly"),(s=n.get(t)).onsuccess=()=>null!=r?r({[""+t]:s.result}):this.store.results(e,o,s.result,t),s.onerror=r=>this.store.onerror(e,o,r,t)}add(e,t,r){this.txo(e).add(r)}put(e,t,r){this.txo(e).put(r)}del(e,t){this.txo(e).delete(t)}insert(e,t){var r,o,s;for(r in s=this.txo(e),t)hasProp.call(t,r)&&(o=t[r],s.add(o))}select(e,t,r=null){this.traverse(e,t,r,"select")}update(e,t){var r,o,s;for(r in s=this.txo(e),t)hasProp.call(t,r)&&(o=t[r],s.put(o))}remove(e,t){this.traverse(e,t,null,"remove")}traverse(e,t,r=null,o){var s,n,i;s="remove"===o?"readwrite":"readonly",i=this.txo(e,s),(n=i.getAll()).onsuccess=()=>{var s,a,l,d;for(s in l={},d=n.result)hasProp.call(d,s)&&(a=d[s],t(a)&&(l[a.id]=a,"remove"===o&&i.delete(a.id)));return null!=r?r(l):this.store.results(e,o,l)},n.onerror=t=>this.store.onerror(e,o,t)}open(e){null!=this.db?this.openStore(this.db,e):this.store.onerror(e,"open","@db null for IndexedDB")}drop(e){null!=this.db?this.db.deleteObjectStore(e):this.store.onerror(e,"drop","@db null for IndexedDB")}};export default Index;