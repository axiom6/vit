"use strict";const PAD_VALUE=Symbol("PadValueType"),_=Symbol("UnderscoreType"),ANY=_,HEAD=Symbol("HeadType"),TAIL=Symbol("TailType"),REST=TAIL;function isValue(t){if(null==t)return!0;const e=typeof t;return"number"===e||"string"===e||"boolean"===e}function isObject(t){return t instanceof Object&&!Array.isArray(t)&&!isValue(t)}function run(t,e){if(isValue(t))return t;if(t instanceof Function)return t.apply(null,e);throw new MatchError(`Unsupported action type ${typeof t} of action ${t}.`)}function matchValue(t,e){if("_"===t)return[!0,[e]];if(t===PAD_VALUE)return[!1,[]];if(t===String){let t="string"==typeof e||e instanceof String;return t?[t,[e]]:[!1,[]]}if(t===Number){let t="number"==typeof e||e instanceof Number;return t?[t,[e]]:[!1,[]]}if(t===Boolean){let t="boolean"==typeof e||e instanceof Boolean;return t?[t,[e]]:[!1,[]]}if(t===Array)return e instanceof Array?[!0,[e]]:[!1,[]];if(Array.isArray(t))return matchArray(t,e);if(t!==Function){if(isValue(t))return[t===e,[]];if(t instanceof Function){return!0===t(e)?[!0,[e]]:[!1,[]]}if(t===_)return[!0,[e]];if(isObject(t))return matchDict(t,e);throw new MatchError(`Pattern ${t} has unsupported type ${typeof t}.`)}try{return e instanceof t?[!0,[e]]:[!1,[]]}catch(t){}return[!1,[]]}function matchArray(t,e){if(!(t instanceof Array&&e instanceof Array))return[!1,[]];let n=[];const r=zipLongest(t,e);for(let t=0;t<r.length;t++){const[o,a]=r[t];if(o===TAIL){if(onlyPadValuesFollow(r,t+1)){n=n.concat([e.slice(t)]);break}throw new MatchError("TAIL/REST must be the last element of a pattern.")}{let[t,e]=matchValue(o,a);if(!t)return[!1,[]];n=n.concat(e)}}return[!0,n]}function keysSet(t){let e={};for(let n in t)t.hasOwnProperty(n)&&(e[n]=!0);return e}function matchDict(t,e){if(!isObject(t)||!isObject(e))return[!1,[]];let n=[],r=keysSet(t),o=keysSet(e);for(let a in t){if(!t.hasOwnProperty(a))continue;if(!(a in r))continue;let i=t[a],c=!1;for(let t in e){if(!e.hasOwnProperty(t))continue;if(!(t in o))continue;if(!(a in r))continue;let l=e[t],[u,f]=matchValue(a,t);if(u){let[e,u]=matchValue(i,l);e&&(delete r[a],delete o[t],n=n.concat(f,u),c=!0)}}if(!c)return[!1,[]]}return[!0,n]}function pairwise(t){let e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}function onlyPadValuesFollow(t,e){for(;e<t.length;e++)if(t[e][0]!==PAD_VALUE)return!1;return!0}function matchPairs(t,...e){if(!e.every(t=>t.length&&2===t.length))throw new MatchError("Even number of pattern-action pairs. Every pattern should have an action.");for(let n=0;n<e.length;n++){let[r,o]=e[n],[a,i]=matchValue(r,t);if(a)return run(o,i)}throw new MatchError(`No _ provided, case ${t} not handled.`)}function match(t){const e=[...arguments].slice(1);if(e.length%2!=0)throw new MatchError("Even number of pattern-action pairs. Every pattern should have an action.");let n=pairwise(e);return matchPairs(t,...n)}function matchAll(t){let e=[];for(let n=0;n<t.length;n++){let r=t[n],o=[...arguments].slice(1),a=match.apply(null,[r].concat(o));e.push(a)}return e}function zipLongest(t,e){let n=Math.max(t.length,e.length),r=[];for(let o=0;o<n;o++){let n=void 0!==t[o]?t[o]:PAD_VALUE,a=void 0!==e[o]?e[o]:PAD_VALUE;r.push([n,a])}return r}class MatchError extends Error{constructor(t){super(),this.message=t,this.name="MatchError",!1===t&&console.log(matchAll,REST)}}export{matchValue,matchArray,matchDict,match,matchAll,matchPairs,zipLongest,PAD_VALUE,_,ANY,HEAD,TAIL,REST};